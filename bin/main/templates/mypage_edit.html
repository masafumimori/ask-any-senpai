<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/reset.min.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
    />
    <link rel="stylesheet" href="/css/page-header.min.css" />
    <link rel="stylesheet" href="/css/mypage.min.css" />
    <title>Ask Any-Senpai</title>
  </head>
  <body>
    <!-- Header -->
    <header th:insert="fragments/page_header::pageHeader"></header>

    <!-- My-page content-->
    <section class="mypage">
      <div class="mypage-box">
       <h2>プロフィール編集</h2>
       <div class="mypage-img" th:if="${user.twitter != null}">
         <img
           th:src="@{'https://unavatar.now.sh/twitter/' + ${user.twitter}}"
           alt="Twitterプロフィール画像"
         />
       </div>
       <div class="mypage-img" th:if="${user.twitter == null}">
         <img class="default-pic" src="/img/default-boy.png" alt="デフォルト画像" />
       </div>
       <div class="mypage-input">
         <label for="userName">ユーザー名：</label>
         <input name="userName" type="text" th:value="${user.userName}">
       </div>
       <div class="mypage-input">
        <label for="password">パスワード：</label>
        <input name="password" type="text" th:value="${user.password}">
      </div>
      <div class="mypage-input">
        <label for="email">メールアドレス：</label>
        <input name="email" type="text" th:value="${user.email}">
      </div>
       <div class="mypage-input" >
         <label>留学した地域：</label>
         <select id="area-select" th:if="${user.area == null}">
           <option value="default">留学した地域を選んでください</option>
         </select>
         <p th:if="${user.area != null}" th:text="${user.area}"></p>
       </div>
       <div class="mypage-input">
        <label>留学した国：</label>
        <select id="nation-select" th:if="${user.nation == null}">
          <option value="default">留学した国を選んでください</option>
        </select>
      </div>
       <div class="mypage-input">
         <p>登録しているSNS：
         <span th:if="${user.twitter == null && user.instagram == null && user.facebook == null}" th:text="未登録"/></span>
         <span th:if="${user.twitter != null}"/>
           <a
           th:if="${user.twitter != null}"
           th:href="@{'https://twitter.com/' + ${user.twitter}}"
           class="twitter"
           target="_blank"
           ><i class="fab fa-twitter"></i
           ></a>
         </span>
         </p>
       </div>
       <div class="btn-box">
         <button id="finish-btn">プロフィール変更</button>
       </div>
      </div>
    </section>
    
        <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(() => {

        // Append options to area select
        Object.keys(areas).forEach(area => {
          let options = "<option value='" + area + "'>" + nations[area] + "</option>";

          $('#area-select').append(options);
        });

        // Append options to nation select
        Object.keys(nations).forEach(nation => {
          let options = "<option value='" + nation + "'>" + nations[nation] + "</option>";

          $('#nation-select').append(options);
        });
        
        // To update profile info
        $('#finish-btn').on('click', (event) => {
          event.preventDefault();
          let update = {
            //data to update 
          }
          $.ajax({
            type: "POST",
            url: "/studyabroad/user/update",
            data: JSON.stringify(update),
            contentType: "application/json",
            dataType: "json"
          })
          .then(
            (result) => {
              alert("プロフィール情報の更新が完了しました。");
              location.replace("/studyabroad/user/mypage");
            },
            () => {
              alert("プロフィール情報の更新に失敗しました。");
            }
          )
        })
      })
      const areas = {
        asia: "アジア",
        europe: "ヨーロッパ",
        america: "アメリカ",
        africa: "アフリカ"
      }

      const nations = {
        america: "アメリカ",
        canada: "カナダ",
        england: "イギリス",
        australia: "オーストラリア",
        newzealand: "ニュージーランド",
        italy: "イタリア",
        spain: "スペイン",
        germany: "ドイツ",
        france: "フランス",
        portugal: "ポルトガル",
        china: "中国",
        korea: "韓国",
        philippines: "フィリピン",
        thailand: "タイ",
        vietnam: "ベトナム"
      }

    </script>
    
  </body>
</html>